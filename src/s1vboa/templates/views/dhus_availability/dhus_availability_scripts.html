<script type="text/javascript">

  {% if data["event_groups"]["planned_imaging"]|length > 0 %}

  {% include "js/dhus_availability/dhus_availability_functions.js" %}
  
  {% include "js/dhus_availability/dhus_availability_data_for_widgets.js" %}

  {% if data["metadata"]["show"]["timeliness"] %}

  {# Timeliness #}
  {% for level in parsed_levels[0] %}
  {% if level in parsed_levels[0] and (expected_dhus_products_duration[level] - missing_dhus_products_duration[level]) > 0 %}

  var groups = [];
  var items = [];

  vboa.prepare_events_data_for_bar(dhus_availability_data_timeliness["{{ level }}"], items, groups);

  var options = {
      legend: true,
      style: "bar",
      barChart: {width:10,
                 align:"center",
                 sideBySide:true},
      height: 350,
      dataAxis: {
          left: {
              range: {
                  min: 0
              },
              title: {
                  text: "Delta time to DHUS (m)",
              }
          }
      }
  };
  
  vboa.display_bar_time("dhus-availability-timeliness-{{ level }}", items, groups, options);

  {# Statistics #}
  var min_dom = document.getElementById("summary-dhus-completeness-minimum-delta-to-dhus-{{ level }}");
  min_dom.innerHTML = vboa.math.min(...dhus_availability_data_timeliness_for_statistics["{{ level }}"]).toFixed(3)
  var max_dom = document.getElementById("summary-dhus-completeness-maximum-delta-to-dhus-{{ level }}");
  max_dom.innerHTML = vboa.math.max(...dhus_availability_data_timeliness_for_statistics["{{ level }}"]).toFixed(3)
  var avg_dom = document.getElementById("summary-dhus-completeness-average-delta-to-dhus-{{ level }}");
  avg_dom.innerHTML = vboa.math.mean(...dhus_availability_data_timeliness_for_statistics["{{ level }}"]).toFixed(3)
  var std_dom = document.getElementById("summary-dhus-completeness-std-delta-to-dhus-{{ level }}");
  std_dom.innerHTML = vboa.math.std(...dhus_availability_data_timeliness_for_statistics["{{ level }}"]).toFixed(3)
  
  {% endif %}
  {% endfor %}

  {% endif %}
  
  {% if data["metadata"]["show"]["completeness"] %}

  {# Pie completeness #}
  {% for level in parsed_levels[0] %}
  {% if level in parsed_levels[0] and expected_dhus_products_duration[level] > 0 %}
  var completeness = [{{ expected_dhus_products_duration[level] - missing_dhus_products_duration[level] }}, {{ missing_dhus_products_duration[level] }}]
  var completeness_background_color = ["green", "darkred"]
  var completeness_labels = ["{{ level }} available in DHUS", "{{ level }} missing in DHUS"]

  var data = {
  datasets: [{
  data: completeness,
  backgroundColor: completeness_background_color
  }],
  labels: completeness_labels
  }
  
  vboa.display_pie("dhus-availability-pie-{{ level }}-completeness", data)
  {% endif %}
  {% endfor %}

  var groups = [];
  var items = [];

  vboa.prepare_events_data_for_timeline(dhus_availability_data_timeline, items, groups);
  vboa.display_timeline("dhus-availability-timeline", items, groups);

  {% endif %}
  
  {% if sliding_window %}
  var parameters = {
      "window_delay": "{{ sliding_window['window_delay'] }}",
      "window_size": "{{ sliding_window['window_size'] }}",
      "mission": "{{ sliding_window['mission'] }}",
      "levels": "{{ sliding_window['levels'] }}"
  }
  var repeat_cycle = {{ sliding_window['repeat_cycle'] }}
  vboa.update_view(parameters, repeat_cycle, "/views/sliding-dhus-availability-parameters");
  {% endif %}
  {% endif %}
</script>
